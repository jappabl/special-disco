<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Lumina - Focus Tracker</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="brand">
          <svg class="logo" width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="16" cy="16" r="14" fill="url(#glow)" opacity="0.3"/>
            <circle cx="16" cy="16" r="12" fill="url(#gradient)" stroke="url(#stroke)" stroke-width="1.5"/>
            <ellipse cx="16" cy="16" rx="8" ry="5" stroke="white" stroke-width="1.5" fill="none" opacity="0.9"/>
            <circle cx="16" cy="16" r="3" fill="white" opacity="0.95"/>
            <circle cx="16" cy="16" r="1.5" fill="url(#pupil)"/>
            <path d="M16 4 L16 8" stroke="url(#ray)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
            <path d="M16 24 L16 28" stroke="url(#ray)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
            <path d="M4 16 L8 16" stroke="url(#ray)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
            <path d="M24 16 L28 16" stroke="url(#ray)" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
            <defs>
              <linearGradient id="gradient" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop offset="0%" stop-color="#8B5CF6"/>
                <stop offset="50%" stop-color="#6366F1"/>
                <stop offset="100%" stop-color="#06B6D4"/>
              </linearGradient>
              <linearGradient id="stroke" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop offset="0%" stop-color="#A78BFA"/>
                <stop offset="100%" stop-color="#22D3EE"/>
              </linearGradient>
              <linearGradient id="pupil" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop offset="0%" stop-color="#6366F1"/>
                <stop offset="100%" stop-color="#8B5CF6"/>
              </linearGradient>
              <linearGradient id="ray" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                <stop offset="0%" stop-color="#06B6D4"/>
                <stop offset="100%" stop-color="#8B5CF6"/>
              </linearGradient>
              <radialGradient id="glow" cx="16" cy="16" r="14" gradientUnits="userSpaceOnUse">
                <stop offset="0%" stop-color="#8B5CF6"/>
                <stop offset="100%" stop-color="#8B5CF6" stop-opacity="0"/>
              </radialGradient>
            </defs>
          </svg>
          <h1>Lumina</h1>
        </div>
        <div id="status-indicator" class="status-indicator unknown">
          <span class="status-dot"></span>
          <span id="status-text">Loading...</span>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">Current State</div>
          <div id="current-state" class="stat-value">--</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Confidence</div>
          <div id="confidence" class="stat-value">--</div>
        </div>
      </div>

      <div class="details">
        <div class="detail-item">
          <span class="detail-label">Active Tab:</span>
          <span id="active-url" class="detail-value">--</span>
        </div>

        <div class="detail-item">
          <span class="detail-label">Background Domains:</span>
          <span id="bg-domains" class="detail-value">--</span>
        </div>

        <div class="detail-item">
          <span class="detail-label">Requests (30s):</span>
          <span id="request-count" class="detail-value">--</span>
        </div>
      </div>

      <div id="alert-section" class="alert-section hidden">
        <div class="alert-icon">!</div>
        <div id="alert-message" class="alert-message"></div>
      </div>

      <div class="footer">
        <button id="refresh-btn" class="btn">Refresh</button>
        <span id="last-update" class="last-update">Last update: --</span>
      </div>

      <div class="settings-section">
        <div class="session-context-section">
          <div class="section-title">What are you working on?</div>
          <div class="task-input-wrapper">
            <input
              type="text"
              id="task-input-inline"
              class="task-input-inline"
              placeholder="Enter your current task (optional)"
            />
            <button id="save-task-btn" class="btn-small save-task-btn">Save</button>
          </div>
        </div>

        <button id="analytics-btn" class="btn btn-analytics">View Analytics</button>
        <div class="domain-buttons">
          <button id="manage-whitelist-btn" class="btn btn-task">Manage Whitelist</button>
          <button id="manage-blacklist-btn" class="btn btn-task">Manage Blacklist</button>
        </div>
        <button id="disable-btn" class="btn btn-danger">Pause Tracking</button>
        <button id="enable-btn" class="btn btn-success hidden">Resume Tracking</button>
      </div>
    </div>

    <!-- Whitelist Modal -->
    <div id="whitelist-modal" class="task-modal hidden">
      <div class="task-modal-content" style="width: 460px; max-height: 80vh; overflow-y: auto;">
        <h2>Manage Whitelist</h2>
        <p class="task-instructions">
          Domains that are <strong>always considered on-task</strong>, even if the AI thinks they might be distracting.
        </p>

        <div class="domain-section">
          <div class="domain-section-header">
            <h3>Whitelisted Domains</h3>
            <button id="add-whitelist-btn" class="btn-small">+ Add Domain</button>
          </div>
          <div id="whitelist-container" class="domain-list"></div>
        </div>

        <div class="task-actions" style="margin-top: 24px;">
          <button id="close-whitelist" class="btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Blacklist Modal -->
    <div id="blacklist-modal" class="task-modal hidden">
      <div class="task-modal-content" style="width: 460px; max-height: 80vh; overflow-y: auto;">
        <h2>Manage Blacklist</h2>
        <p class="task-instructions">
          Domains that are <strong>always considered off-task</strong>, regardless of content. Pre-loaded with common distracting sites.
        </p>

        <div class="domain-section">
          <div class="domain-section-header">
            <h3>Blacklisted Domains</h3>
            <button id="add-blacklist-btn" class="btn-small">+ Add Domain</button>
          </div>
          <div id="blacklist-container" class="domain-list"></div>
        </div>

        <div class="task-actions" style="margin-top: 24px;">
          <button id="close-blacklist" class="btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Session Context Modal -->
    <div id="task-modal" class="task-modal hidden">
      <div class="task-modal-content">
        <h2>What are you working on?</h2>
        <p class="task-instructions">
          Declare your current work task so the AI can accurately detect off-task behavior based on
          your actual context. Leave blank to use default productivity context.
        </p>

        <div class="task-input-section">
          <label for="task-input">Current work task (optional):</label>
          <input
            type="text"
            id="task-input"
            class="task-input"
            placeholder='e.g., "Working on Python project", "Shopping for furniture" (or leave blank)'
          />
        </div>

        <div class="task-examples">
          <strong>Examples:</strong>
          <ul>
            <li>"Working on React front-end project"</li>
            <li>"Writing research paper on climate change"</li>
            <li>"Shopping for office furniture"</li>
            <li>"Learning machine learning algorithms"</li>
          </ul>
        </div>

        <div class="task-actions">
          <button id="submit-task" class="btn btn-primary">Set Task</button>
          <button id="cancel-task" class="btn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Puzzle Challenge Modal -->
    <div id="puzzle-modal" class="puzzle-modal hidden">
      <div class="puzzle-modal-content">
        <h2>Taking a Break?</h2>
        <p class="puzzle-instructions">
          Solve <span id="puzzles-remaining">10</span> puzzles to pause tracking
        </p>

        <div class="puzzle-display">
          <div class="puzzle-type-badge" id="puzzle-type">MATH</div>
          <div class="puzzle-question" id="puzzle-question">What is 2 + 2?</div>
        </div>

        <input type="text" id="puzzle-answer" class="puzzle-input" placeholder="Your answer" />
        <div id="puzzle-feedback" class="puzzle-feedback"></div>

        <div class="puzzle-actions">
          <button id="submit-puzzle" class="btn btn-primary">Submit</button>
          <button id="cancel-puzzles" class="btn">Cancel</button>
        </div>
      </div>
    </div>

    <script type="module" src="popup.ts"></script>
  </body>
</html>
